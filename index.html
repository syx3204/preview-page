<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>音乐解析</title>
    <style>
        /* 加载动画样式 */
        @font-face {
            font-family: 'MyFont';
            src: url('https://m.ccw.site/creator-college/videos/48cbf6a175c7b59e534049e599eb5598.ttf') format('truetype');
        }
        * {
            font-family: 'MyFont', sans-serif !important;
        }
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            background: #f5f5f5;
            transition: opacity 0.5s;
        }
        .loading-container {
            text-align: center;
            padding: 30px;
            background: rgba(255,255,255,0.9);
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            max-width: 90%;
        }
        .spinner {
            width: 60px;
            height: 60px;
            margin: 0 auto 20px;
        }
        .spinner svg {
            animation: rotate 2s linear infinite;
        }
        .spinner circle {
            stroke-dasharray: 1, 200;
            stroke-dashoffset: 0;
            animation: dash 1.5s ease-in-out infinite, colors 6s ease-in-out infinite;
            stroke-linecap: round;
            stroke-width: 3;
        }
        @keyframes rotate { 100% { transform: rotate(360deg); } }
        @keyframes dash {
            0% { stroke-dasharray: 1, 200; stroke-dashoffset: 0; }
            50% { stroke-dasharray: 89, 200; stroke-dashoffset: -35; }
            100% { stroke-dasharray: 89, 200; stroke-dashoffset: -124; }
        }
        @keyframes colors {
            0%,100% { stroke: #4285f4; }
            25% { stroke: #ea4335; }
            50% { stroke: #fbbc05; }
            75% { stroke: #34a853; }
        }
        .loading-text {
            font-size: 18px;
            margin-bottom: 10px;
        }
        .quote {
            font-style: italic;
            color: #666;
            max-width: 300px;
            margin: 0 auto;
        }
        
        /* 音乐信息样式 */
        .music-container {
            display: none;
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
            background: white;
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }
        .cover {
            width: 200px;
            height: 200px;
            border-radius: 8px;
            margin: 0 auto 20px;
            display: block;
            object-fit: cover;
        }
        .info {
            text-align: center;
        }
        .title {
            font-size: 24px;
            margin-bottom: 5px;
        }
        .artist, .album {
            color: #666;
            margin: 5px 0;
        }
        .lyrics {
            white-space: pre-wrap;
            margin-top: 20px;
            padding: 15px;
            background: #f5f5f5;
            border-radius: 8px;
            max-height: 300px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <!-- 加载动画 -->
    <div class="loading-container" id="loading">
        <div class="spinner">
            <svg viewBox="25 25 50 50">
                <circle cx="50" cy="50" r="20" fill="none" stroke-width="3" stroke-miterlimit="10"/>
            </svg>
        </div>
        <div class="loading-text">正在加载音乐数据...</div>
        <div class="quote" id="quote"></div>
    </div>

    <!-- 音乐信息 -->
    <div class="music-container" id="musicInfo">
        <img class="cover" id="cover" alt="专辑封面">
        <div class="info">
            <h1 class="title" id="title"></h1>
            <p class="artist" id="artist"></p>
            <p class="album" id="album"></p>
        </div>
        <div class="lyrics" id="lyrics"></div>
    </div>

    <script>
        // 名言数据
        const quotes = [
            { text: "音乐是上帝赐给人类最美的礼物", author: "马丁·路德" },
            { text: "没有音乐，生活将是一个错误", author: "尼采" },
            { text: "音乐是唯一的世界语言", author: "理查德·瓦格纳" },
            { text: "音乐是心灵的语言", author: "贝多芬" },
            { text: "音乐是人类的共同记忆", author: "鲍勃·迪伦" }
        ];

        // 显示随机名言
        function showRandomQuote() {
            const quote = quotes[Math.floor(Math.random() * quotes.length)];
            document.getElementById('quote').textContent = `"${quote.text}" — ${quote.author}`;
        }

        // 解析URL参数
        function getUrlParams() {
            const params = new URLSearchParams(window.location.search);
            return {
                id: params.get('id'),
                platform: params.get('f')
            };
        }

        // 获取音乐数据
        async function fetchMusicData() {
            const { id, platform } = getUrlParams();
            
            if (!id || !platform) {
                throw new Error('缺少参数: id 和 f 是必需的');
            }

            // 通过代理接口获取数据
            const response = await fetch(`/api/proxy?platform=${platform}&id=${id}`);
            const data = await response.json();

            if (!data || data.code !== 200) {
                throw new Error('音乐数据解析失败');
            }

            return data;
        }

        // 显示音乐信息
        function displayMusicInfo(data) {
            document.getElementById('cover').src = data.cover || 'https://via.placeholder.com/200';
            document.getElementById('title').textContent = data.title || '未知歌曲';
            document.getElementById('artist').textContent = `歌手: ${data.artist || '未知'}`;
            document.getElementById('album').textContent = `专辑: ${data.album || '未知'}`;
            document.getElementById('lyrics').textContent = data.lyric || '暂无歌词';
            
            // 切换显示
            document.getElementById('loading').style.display = 'none';
            document.getElementById('musicInfo').style.display = 'block';
        }

        // 错误处理
        function handleError(error) {
            console.error('Error:', error);
            window.location.href = '404.html';
        }

        // 初始化
        async function init() {
            try {
                showRandomQuote();
                const musicData = await fetchMusicData();
                displayMusicInfo(musicData);
            } catch (error) {
                handleError(error);
            }
        }

        // 启动
        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
