<!DOCTYPE html>
<html lang="zh-CN">
    <!-- 未经允许，盗用必究！ -->
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>loading...</title>
    <style>
        @font-face {
            font-family: 'MyFont';
            src: url('https://m.ccw.site/creator-college/videos/48cbf6a175c7b59e534049e599eb5598.ttf') format('truetype');
        }
        *, 
        ::placeholder,
        ::before, 
        ::after {
            font-family: 'MyFont', sans-serif !important;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* 动态背景 */
        .dynamic-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -2;
            background-size: cover;
            background-position: center;
            transition: filter 1.5s ease, background-image 1.2s cubic-bezier(0.23, 1, 0.32, 1);
            filter: brightness(0.8) contrast(1.1);
        }

        .bg-blur {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            backdrop-filter: blur(15px) brightness(0.6);
            -webkit-backdrop-filter: blur(15px) brightness(0.6);
        }

        /* 加载容器 */
        .loading-container {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: flex;
            flex-direction: column;
            align-items: center;
            max-width: min(680px, 90vw);
            padding: 40px;
            background: rgba(255, 255, 255, 0.12);
            backdrop-filter: blur(24px) saturate(180%);
            border-radius: 24px;
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.15);
        }

        /* 加载动画 */
        .spinner-container {
            width: 80px;
            height: 80px;
            margin-bottom: 30px;
        }

        .circular {
            animation: rotate 2s linear infinite;
            width: 100%;
            height: 100%;
        }

        .path {
            stroke-dasharray: 1, 200;
            stroke-dashoffset: 0;
            animation: 
                dash 1.5s ease-in-out infinite,
                colors 6s ease-in-out infinite;
            stroke-linecap: round;
            stroke-width: 4;
            fill: none;
        }

        @keyframes rotate { 100% { transform: rotate(360deg); } }
        @keyframes dash {
            0% { stroke-dasharray: 1, 200; stroke-dashoffset: 0; }
            50% { stroke-dasharray: 89, 200; stroke-dashoffset: -35px; }
            100% { stroke-dasharray: 89, 200; stroke-dashoffset: -124px; }
        }
        @keyframes colors {
            0%, 100% { stroke: #ff6b6b; }
            40% { stroke: #4ecdc4; }
            66% { stroke: #45b7d1; }
            80%, 90% { stroke: #96c93d; }
        }

        /* 加载文字 */
        .loading-text {
            color: rgba(255, 255, 255, 0.9);
            font-size: 1.2rem;
            margin-bottom: 25px;
            text-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        /* 名言样式 */
        .hitokoto-box {
            max-width: 600px;
            text-align: center;
        }

        .char {
            font-size: 1.1rem;
            color: rgba(255, 255, 255, 0.85);
            display: inline-block;
            opacity: 0;
            transform: translateY(20px);
            animation: charAppear 0.6s cubic-bezier(0.2, 0.7, 0.3, 1) forwards;
        }

        @keyframes charAppear { to { opacity: 1; transform: translateY(0); } }

        .from-text {
            color: rgba(255, 255, 255, 0.7);
            margin-top: 20px;
            font-size: 0.95rem;
            opacity: 0;
            animation: fadeIn 0.6s 1s ease-out forwards;
        }

        /* 音乐卡片 */
        .music-card {
            width: 100%;
            max-width: 800px;
            background: rgba(255, 255, 255, 0.12);
            backdrop-filter: blur(24px) saturate(180%);
            border-radius: 24px;
            padding: 40px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.15);
            display: none;
            opacity: 0;
            transform: translateY(20px);
            animation: cardAppear 0.8s ease-out forwards;
        }

        @keyframes cardAppear {
            to { opacity: 1; transform: translateY(0); }
        }

        .cover-container {
            width: 280px;
            height: 280px;
            margin: 0 auto 30px;
            border-radius: 18px;
            overflow: hidden;
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.3);
            transition: transform 0.6s cubic-bezier(0.23, 1, 0.32, 1);
        }

        .cover {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.6s cubic-bezier(0.23, 1, 0.32, 1);
        }

        .music-title {
            font-size: 2.2rem;
            color: #fff;
            text-align: center;
            margin-bottom: 15px;
            position: relative;
            padding-bottom: 10px;
        }

        .music-title::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 60px;
            height: 2px;
            background: linear-gradient(90deg, #ff6b6b 0%, #4ecdc4 100%);
        }

        .music-subtitle {
            font-size: 1.2rem;
            color: rgba(255, 255, 255, 0.8);
            text-align: center;
            margin-bottom: 20px;
        }

        .music-meta {
            font-size: 1rem;
            color: rgba(255, 255, 255, 0.7);
            text-align: center;
            margin-bottom: 8px;
        }

        .action-button {
            display: inline-block;
            padding: 12px 35px;
            background: linear-gradient(135deg, #ff6b6b 0%, #4ecdc4 100%);
            color: white;
            border-radius: 30px;
            font-weight: 500;
            text-decoration: none;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            transition: all 0.4s cubic-bezier(0.23, 1, 0.32, 1);
            border: none;
            cursor: pointer;
            margin-top: 25px;
            position: relative;
            overflow: hidden;
        }

        .action-button::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, 
                transparent 25%,
                rgba(255,255,255,0.15) 50%,
                transparent 75%);
            animation: shine 3s infinite;
        }

        @keyframes shine {
            100% { transform: translateX(100%); }
        }

        .lyrics-container {
            margin-top: 30px;
            padding-top: 25px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .lyrics-content {
            max-height: 300px;
            overflow-y: auto;
            padding: 20px;
            background: rgba(0, 0, 0, 0.15);
            border-radius: 12px;
            color: rgba(255, 255, 255, 0.85);
            line-height: 1.8;
            font-size: 0.95rem;
            scrollbar-width: thin;
            scrollbar-color: rgba(255,255,255,0.3) transparent;
        }

        .lyrics-content::-webkit-scrollbar {
            width: 6px;
        }

        .lyrics-content::-webkit-scrollbar-thumb {
            background: rgba(255,255,255,0.3);
            border-radius: 4px;
        }

        /* 响应式设计 */
        @media (max-width: 768px) {
            .loading-container {
                padding: 30px;
                border-radius: 20px;
            }
            
            .music-card {
                padding: 30px;
                border-radius: 20px;
            }
            
            .cover-container {
                width: 220px;
                height: 220px;
            }
            
            .music-title {
                font-size: 1.8rem;
            }
        }
    </style>
</head>
<body>
    <div class="dynamic-bg" id="dynamicBg"></div>
    <div class="bg-blur"></div>

    <!-- 加载状态 -->
    <div class="loading-container" id="loading">
        <div class="spinner-container">
            <svg viewBox="25 25 50 50" class="circular">
                <circle class="path" cx="50" cy="50" r="20" stroke-miterlimit="10"/>
            </svg>
        </div>
        <div class="loading-text">解析音乐数据中</div>
        <div class="hitokoto-box">
            <div class="typing-container">
                <div class="hitokoto-text" id="quoteText"></div>
            </div>
        </div>
        <div class="from-text" id="quoteAuthor"></div>
    </div>

    <!-- 音乐卡片 -->
    <div class="music-card" id="musicCard">
        <div class="cover-container">
            <img class="cover" id="cover" alt="专辑封面" onerror="this.onerror=null;this.src='https://via.placeholder.com/500?text=No+Cover'">
        </div>
        
        <div class="music-info">
            <h1 class="music-title" id="musicTitle"></h1>
            <p class="music-subtitle" id="musicSubtitle"></p>
            <p class="music-meta" id="musicArtist"></p>
            <p class="music-meta" id="musicAlbum"></p>
            <p class="music-meta" id="musicTime"></p>
            
            <button id="actionButton" class="action-button">跳转播放</button>
            
            <div class="lyrics-container">
                <div class="lyrics-title">歌词</div>
                <div class="lyrics-content" id="lyricsContent"></div>
            </div>
        </div>
    </div>

    <script>
        // 加载动画相关
        class BackgroundManager {
            constructor() {
                this.bgElement = document.getElementById('dynamicBg');
                this.bgCache = [];
                this.currentBgIndex = 0;
                this.init();
            }

            init() {
                this.preloadBackground();
                setInterval(() => this.changeBackground(), 15000);
            }

            async preloadBackground() {
                try {
                    const newBg = await this.loadImage();
                    this.bgCache.push(newBg);
                    this.updateBackground();
                } catch (error) {
                    console.error('背景加载失败:', error);
                }
            }

            async loadImage() {
                return new Promise((resolve, reject) => {
                    const img = new Image();
                    img.crossOrigin = "anonymous";
                    img.src = `https://m.ccw.site/creator-college/images/e16e5757bff59acfe2c0d78301abb50e.jpg?x-oss-process=image%2Fformat%2Cwebp`;
                    img.onload = () => resolve(img.src);
                    img.onerror = reject;
                });
            }

            async changeBackground() {
                try {
                    const newBg = await this.loadImage();
                    this.bgCache.push(newBg);
                    if (this.bgCache.length > 3) this.bgCache.shift();
                    this.updateBackground();
                } catch (error) {
                    console.error('背景切换失败:', error);
                }
            }

            updateBackground() {
                this.bgElement.style.backgroundImage = `url(${this.bgCache[this.currentBgIndex]})`;
                this.currentBgIndex = (this.currentBgIndex + 1) % this.bgCache.length;
            }
        }

        // 名言数据
        class HitokotoLoader {
            static customHitokotos = [
                // 保持原有名言数据不变
                // 此处为节省篇幅省略数据，实际使用时需保留完整列表
            ];

            constructor() {
                this.textEl = document.getElementById('quoteText');
                this.fromEl = document.getElementById('quoteAuthor');
                new BackgroundManager();
            }

            async init() {
                try {
                    const data = await this.fetchHitokoto();
                    this.createTextAnimation(`「${data.hitokoto}」`);
                    this.showSource(data);
                } catch (error) {
                    this.handleError(error);
                }
            }

            async fetchHitokoto() {
                try {
                    const response = await fetch('https://v1.hitokoto.cn/?encode=json');
                    return response.json();
                } catch (error) {
                    throw new Error(`数据加载失败: ${error.message}`);
                }
            }

            createTextAnimation(text) {
                const chars = text.split('').map((char, index) => ({
                    char,
                    delay: index * 60
                }));
                
                this.textEl.innerHTML = chars.map(({ char, delay }) => 
                    `<span class="char" style="animation-delay: ${delay}ms">${char}</span>`
                ).join('');
            }

            showSource(data) {
                let fromText = data.from || '';
                if (data.from_who) fromText += fromText ? ` · ${data.from_who}` : data.from_who;
                this.fromEl.textContent = `—— ${fromText || '未知来源'}`;
            }

            handleError(error) {
                console.error('Error:', error);
                const randomIndex = Math.floor(Math.random() * HitokotoLoader.customHitokotos.length);
                const selected = HitokotoLoader.customHitokotos[randomIndex];
                this.createTextAnimation(`「${selected.hitokoto}」`);
                this.fromEl.textContent = `—— ${selected.from || '未知来源'}`;
            }
        }

        // 音乐数据相关
        async function fetchMusicData() {
            const params = new URLSearchParams(window.location.search);
            const id = params.get('id');
            const platform = params.get('f');
            const type = params.get('t') || '0';

            if (!id || !platform) throw new Error('缺少参数');

            try {
                const endpoint = platform === '1' 
                    ? `/api/qqmusic?id=${id}&t=${type}`
                    : `/api/proxy?platform=${platform}&id=${id}`;
                
                const data = await fetch(endpoint).then(r => r.json());
                return data.code === 200 ? data : Promise.reject(data);
            } catch (error) {
                throw new Error(`数据加载失败: ${error.message}`);
            }
        }

        function displayMusicInfo(data) {
            document.getElementById('dynamicBg').style.backgroundImage = `url(${data.cover})`;
            document.title = `${data.title} - ${data.artist}`;

            document.getElementById('cover').src = data.cover || 'https://via.placeholder.com/500?text=No+Cover';
            document.getElementById('musicTitle').textContent = data.title;
            document.getElementById('musicArtist').textContent = `歌手: ${data.artist}`;
            document.getElementById('musicAlbum').textContent = `专辑: ${data.album}`;
            document.getElementById('musicTime').textContent = `发行时间: ${data.time}`;
            document.getElementById('lyricsContent').textContent = data.lyric || '暂无歌词';

            const actionButton = document.getElementById('actionButton');
            if (data.link) {
                actionButton.onclick = () => window.open(data.link, '_blank');
                actionButton.style.display = 'inline-block';
            } else {
                actionButton.style.display = 'none';
            }

            document.getElementById('loading').style.display = 'none';
            document.getElementById('musicCard').style.display = 'block';
        }

        // 初始化
        async function init() {
            new HitokotoLoader().init();
            try {
                const musicData = await fetchMusicData();
                displayMusicInfo(musicData);
            } catch (error) {
                console.error(error);
                window.location.href = '404.html';
            }
        }

        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
    <!-- 未经允许，盗用必究！ -->
</html>
